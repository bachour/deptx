{% load staticfiles %}
<head>
<link rel="stylesheet" type="text/css" href="{% static "mop/mop.css" %}">

<script src="http://ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
<script src="{% static "mop/js/spin.js" %}"></script>

<script>

var opts = {
	lines: 13, // The number of lines to draw
	length: 20, // The length of each line
	width: 10, // The line thickness
	radius: 30, // The radius of the inner circle
	corners: 1, // Corner roundness (0..1)
	rotate: 0, // The rotation offset
	direction: 1, // 1: clockwise, -1: counterclockwise
	color: '#000', // #rgb or #rrggbb or array of colors
	speed: 1, // Rounds per second
	trail: 60, // Afterglow percentage
	shadow: false, // Whether to render a shadow
	hwaccel: false, // Whether to use hardware acceleration
	className: 'spinner', // The CSS class to assign to the spinner
	zIndex: 2e9, // The z-index (defaults to 2000000000)
	top: 'auto', // Top position relative to parent in px
	left: 'auto', // Left position relative to parent in px
	position: 'relative',
};

var target;
var spinner;
var audioGotMail;

$(function() {
	target = document.getElementById('spinner');
	audioGotMail = document.createElement('audio');
	audioGotMail.setAttribute('src', '{% static 'mop/sound/mail.mp3' %}');
	
});

window.setInterval(function(){
	mailfield = $('#checkmail');
	inboxfield = $('#inbox');
	
	spinner = new Spinner(opts).spin(target);
	mailfield.html('checking mail...');
	
	setTimeout(function(){
	
		$.ajax
		(
			{
		    	type: "POST",
		    	url:"{% url 'mop_mail_check' %}",
		    	data:
		    	{
		    		'test': 'success',
	    		},
	    		success: function(data)
	    		{
	      			if (data.mail_count==0) {
	      				mailfield.html('no new messages');
	      			}
	      			else {
	      				mailfield.html(data.mail_count + ' new message(s)');
	      				inboxfield.val('inbox (' + data.total_unread + ')');
	      				audioGotMail.play();
	      			};
	      			spinner.stop();
	      			
	     		},
	    		error: function()
	    		{
	        		mailfield.html('error checking messages');
	        		spinner.stop();
				}
			}
		);
	
	},5000);
	
	
	
  
}, 10000);

</script>


{% block head %}
{% endblock %}

</head>

<body>


<div class="wrapper">
	
	<div class="header">
		<marquee behavior="scroll" direction="left">
		<span class="marquee"></span>
		<span class="marquee">MoP - Proudly watching you since 1872</span>
		<span class="marquee">MoP - Putting the form back into information</span>
		<span class="marquee">MoP - He who controls the past controls the future. He who controls the present controls the past.</span>
		<span class="marquee">MoP - War is peace. Freedom is slavery. Ignorance is strength.</span>
		<span class="marquee">MoP - Keep calm and carry on.</span>
		<span class="marquee">MoP - The need is great, the time is short, PROVENANCE must be the watchword.</span>
		</marquee>
	</div>
	
	<div class="navbar">
		<table>
		<tr>
			<td class="nobox"><a class="button" href="{% url 'mop_index' %}"><input class="button" type="submit" value="control centre" /></a></td>
			<td class="nobox">--- Citizen Employee {{user.mop.firstname}} {{user.mop.lastname}} --- </td>
			<td class="nobox"><a class="button" href="{% url 'mop_logout' %}"><input class="button" type="submit" value="logout" /></a></td> 
			<td class="nobox"><span id="checkmail" /></span></td>
			<td class="nobox"><div id="spinner" style="-webkit-transform:scale(.35);"></div></td>
		</tr>
		</table>
	</div>
	
	<div class="main">
		<div class="content">
			{% block content %}
			{% endblock %}
		</div>
		<div class="sidebar">
			<div class="withImage"><img src="{% static 'mop/logo-mop-bg.png' %}"/><h1>Guidance</h1></div>
			{% block help %}
			{% endblock %}
		</div>
	</div>
</div>



</body>