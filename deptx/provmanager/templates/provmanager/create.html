<html>
<head>
  <title></title>
</head>
<body>
<form action="{% url 'provmanager_create' %}" method="post">{% csrf_token %}
<textarea name="graphml" id="drop_zone" style="width:480px; height:80px">{{graphml_str}}</textarea><br/>
<input type="submit" value="Convert" name="convert" />

{% if valid == None %}
{% else %}

	{% if valid %}Valid document!
	{% else %} INVALID DOCUMENT!
	{% endif %}
	<a href="{{validation_url}}" target="_blank">Check Report</a><br/>
	<br/><br/>
	
	<textarea name="json" style="width:480px; height:80px">{{json_str}}</textarea>
	<br/><br/>
	Ingame preview:
	<br/><br/>
	{% include 'provmanager/improve.html' %}
	<br/><br/>
	{% if valid %}
	Provenance name: <input type="text" name="name" value=""/>
	<br/><br/>
	<input type="submit" value="Save" name="save" />
	{% endif %}
{% endif %}
</form>
<br/><br/>
<script>
  function handleFileSelect(evt) {
    evt.stopPropagation();
    evt.preventDefault();

    var files = evt.dataTransfer.files; // FileList object.
    var reader = new FileReader();  
    reader.onload = function(event) {            
         document.getElementById('drop_zone').value = event.target.result;
    }        
    reader.readAsText(files[0],"UTF-8");
  }

  function handleDragOver(evt) {
    evt.stopPropagation();
    evt.preventDefault();
    evt.dataTransfer.dropEffect = 'copy'; // Explicitly show this is a copy.
  }

  // Setup the dnd listeners.
  var dropZone = document.getElementById('drop_zone');
  dropZone.addEventListener('dragover', handleDragOver, false);
  dropZone.addEventListener('drop', handleFileSelect, false);
</script>
</body>
</html>